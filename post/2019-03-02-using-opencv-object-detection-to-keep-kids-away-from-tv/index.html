<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Using OpenCV object detection to keep kids away from TV - Ephemeral Dance Of Electrons</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="tmzh"><meta name=description content=" Give me a dozen healthy infants, well formed, and my own specified world to bring them up in and I’ll guarantee to take any one at random and train him to become any type of specialist I might select—doctor, lawyer, artist, merchant-chief and yes, even beggar-man thief, regardless of his talents, penchants, tendencies, abilities, vocations, and race of his ancestors.
This was John Watson, one of the founders of Behaviorism, writing around 1925. He believed that human behavior is completely malleable and that it can be shaped into anything given the right environment. While I don&amp;rsquo;t harbor any grand objectives or sinister experiments like Watson did, I do hope to be able to teach my kids good habits using controlled environments. For instance, my two year old kids started developing the habit of getting too close to the TV. I didn&amp;rsquo;t want to use force or impose restrictions on them, so I thought I could use technology to discourage them from getting too close to TV.
"><meta name=keywords content="blog,code,recreational"><meta name=generator content="Hugo 0.120.4 with theme even"><link rel=canonical href=https://tmzh.github.io/post/2019-03-02-using-opencv-object-detection-to-keep-kids-away-from-tv/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><meta property="og:title" content="Using OpenCV object detection to keep kids away from TV"><meta property="og:description" content="
Give me a dozen healthy infants, well formed, and my own specified world to bring them up in and I’ll guarantee to take any one at random and train him to become any type of specialist I might select—doctor, lawyer, artist, merchant-chief and yes, even beggar-man thief, regardless of his talents, penchants, tendencies, abilities, vocations, and race of his ancestors.

This was John Watson, one of the founders of Behaviorism, writing around 1925. He believed that human behavior is completely malleable and that it can be shaped into anything given the right environment. While I don&rsquo;t harbor any grand objectives or sinister experiments like Watson did, I do hope to be able to teach my kids good habits using controlled environments. For instance, my two year old kids started developing the habit of getting too close to the TV. I didn&rsquo;t want to use force or impose restrictions on them, so I thought I could use technology to discourage them from getting too close to TV."><meta property="og:type" content="article"><meta property="og:url" content="https://tmzh.github.io/post/2019-03-02-using-opencv-object-detection-to-keep-kids-away-from-tv/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-03-02T12:00:00+00:00"><meta property="article:modified_time" content="2019-03-02T12:00:00+00:00"><meta itemprop=name content="Using OpenCV object detection to keep kids away from TV"><meta itemprop=description content="
Give me a dozen healthy infants, well formed, and my own specified world to bring them up in and I’ll guarantee to take any one at random and train him to become any type of specialist I might select—doctor, lawyer, artist, merchant-chief and yes, even beggar-man thief, regardless of his talents, penchants, tendencies, abilities, vocations, and race of his ancestors.

This was John Watson, one of the founders of Behaviorism, writing around 1925. He believed that human behavior is completely malleable and that it can be shaped into anything given the right environment. While I don&rsquo;t harbor any grand objectives or sinister experiments like Watson did, I do hope to be able to teach my kids good habits using controlled environments. For instance, my two year old kids started developing the habit of getting too close to the TV. I didn&rsquo;t want to use force or impose restrictions on them, so I thought I could use technology to discourage them from getting too close to TV."><meta itemprop=datePublished content="2019-03-02T12:00:00+00:00"><meta itemprop=dateModified content="2019-03-02T12:00:00+00:00"><meta itemprop=wordCount content="1715"><meta itemprop=keywords content="python,opencv,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using OpenCV object detection to keep kids away from TV"><meta name=twitter:description content="
Give me a dozen healthy infants, well formed, and my own specified world to bring them up in and I’ll guarantee to take any one at random and train him to become any type of specialist I might select—doctor, lawyer, artist, merchant-chief and yes, even beggar-man thief, regardless of his talents, penchants, tendencies, abilities, vocations, and race of his ancestors.

This was John Watson, one of the founders of Behaviorism, writing around 1925. He believed that human behavior is completely malleable and that it can be shaped into anything given the right environment. While I don&rsquo;t harbor any grand objectives or sinister experiments like Watson did, I do hope to be able to teach my kids good habits using controlled environments. For instance, my two year old kids started developing the habit of getting too close to the TV. I didn&rsquo;t want to use force or impose restrictions on them, so I thought I could use technology to discourage them from getting too close to TV."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Ephemeral Dance Of Electrons</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Ephemeral Dance Of Electrons</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Using OpenCV object detection to keep kids away from TV</h1><div class=post-meta><span class=post-time>2019-03-02</span><div class=post-category><a href=/categories/image-recognition/>Image recognition</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#problem-statement>Problem statement</a></li><li><a href=#tools-and-solutions>Tools and solutions</a></li><li><a href=#using-contour-detection>Using Contour detection</a></li><li><a href=#controlling-the-playback>Controlling the playback</a></li><li><a href=#results>Results</a></li></ul></li></ul></nav></div></div><div class=post-content><blockquote><p>Give me a dozen healthy infants, well formed, and my own specified world to bring them up in and I’ll guarantee to take any one at random and train him to become any type of specialist I might select—doctor, lawyer, artist, merchant-chief and yes, even beggar-man thief, regardless of his talents, penchants, tendencies, abilities, vocations, and race of his ancestors.</p></blockquote><p>This was John Watson, one of the founders of <a href=https://www.wikiwand.com/en/Behaviorism>Behaviorism</a>, writing around 1925. He believed that human behavior is completely malleable and that it can be shaped into anything given the right environment. While I don&rsquo;t harbor any grand objectives or sinister experiments like Watson did, I do hope to be able to teach my kids good habits using controlled environments. For instance, my two year old kids started developing the habit of getting too close to the TV. I didn&rsquo;t want to use force or impose restrictions on them, so I thought I could use technology to discourage them from getting too close to TV.</p><h2 id=problem-statement>Problem statement</h2><p>I play YouTube rhymes on my HTPC which is connected to our living room TV. While watching they sometimes get down from the couch and walk to the TV. When they do, I want to turn off the video automatically to let them know that they have gone too close and not resume the playback until they get back to the couch. For my setup, that means pausing the youtube player and minimzing the browser.</p><p>Fortunately this is easy to do with a camera and <a href=https://github.com/opencv/opencv>OpenCV</a>. Let us see how.</p><h2 id=tools-and-solutions>Tools and solutions</h2><p>Object detection is among the fundamental features of OpenCV and there are a few ways to do it. I explored three of them:</p><ol><li><p><em>Using HAAR Cascades</em>:
This is a popular object detection method in OpenCV. It uses models that are trained on a lot of positive and negative images and extracting features from those images. The training step is optional here as there are lot of pre-trained models available to detect face and human bodies. However for my case, those models didn&rsquo;t do well due to the awkward angle at which my camera was placed. Training my own model based on an image corpus is also not an option since asking two year olds to hold postures for model training is a non-trivial endeavour.</p></li><li><p><em>Background Subtraction</em>:
Among all the methods this is the one which impressed me! All we need is a single call to <code>opencv2.createBackgroundSubtractorMOG()</code> to identify moving objects in the foreground and to eliminate static background. The method works by subtracting pixels from subsequent frames of a video and extracting those that change. However this method left a relatively larger footprint on the CPU (still not significant). I was also put off by the false shadow objects created under changing light conditions. But the biggest problem for me was that initial state of the frame was out of my control, so a person moving out of the frame would trigger object detection in the same way as a new person moving in. Asking my family to stay still as the computer boots up is a tricky request&mldr; even by my standards.</p></li><li><p><em>Contour detection</em>:
This is among the cheaper method in terms of computational requirements and it was just the method I needed for my simple requirement. It works by identifying contours in a picture. If the picture is black and white, the contour detection works better. Fortunately, since I only needed to detect a head in the visual frame and the hair in the head helped to distinguish the contours clearly. So this seemed to be the best fit for my requirement and I went with it.</p></li></ol><h2 id=using-contour-detection>Using Contour detection</h2><p>With the default OpenCV video capture drivers, my camera returned a frame with resolution 640 x 480 pixels. Here you can see my son lost in the colorful world of baby rhymes, hoping to dive into the TV to enjoy the rhymes in full splendor.</p><p><img src=/images/naughty-kid.png alt="Naughty kid"></p><p>First I cropped the image to focus only on the area that I want to monitor- a small rectange close to TV. Blurring was done to smoothen the contours.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>cropped</span> <span class=o>=</span> <span class=n>frame</span><span class=p>[</span><span class=mi>100</span><span class=p>:</span><span class=mi>300</span><span class=p>,</span> <span class=mi>0</span><span class=p>:</span><span class=mi>630</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Blur the image</span>
</span></span><span class=line><span class=cl><span class=n>blurred</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>blur</span><span class=p>(</span><span class=n>cropped</span><span class=p>,</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/cropped.png alt="Cropped image"></p><p>Next I needed to convert color channels. Contour detection is not efficient when the color intensities are in 3 dimensions (RGB). The job is greatly simplified if we can restict the colors to a single dimension. And it works even better with binary images where the pixels are either pure black or white (even for us black and white are easier to tell apart than a million shades of other colors in between).</p><p>So we apply a threshold using <code>cv2.inRange</code> function which converts the image to black and white (not grey scale). This is done by specifying a range of interesting colors and every pixel that fall in the range will be converted to white and rest to black.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Convert to HSV color space</span>
</span></span><span class=line><span class=cl><span class=n>hsv</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>blurred</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_BGR2HSV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># define range of blue color in HSV</span>
</span></span><span class=line><span class=cl><span class=n>lower_black</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>upper_black</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>180</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>50</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create a binary image with where the head will be white while the rest is black</span>
</span></span><span class=line><span class=cl><span class=n>thresh</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>inRange</span><span class=p>(</span><span class=n>hsv</span><span class=p>,</span> <span class=n>lower_black</span><span class=p>,</span> <span class=n>upper_black</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/filtered.png alt="Thresholded image"></p><p>Finally we turn to the <code>cv2.findContours</code> method. The <code>cv2.findContours</code> method returns an array of contours. I looked for the largest contour by area and triggered helper methods when the area was bigger than a threshold. We can even plot the contours to see how our object detection works, as I have done in the picture below.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>_</span><span class=p>,</span> <span class=n>contours</span><span class=p>,</span> <span class=n>hierarchy</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>findContours</span><span class=p>(</span><span class=n>thresh</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>RETR_TREE</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>CHAIN_APPROX_SIMPLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>contours</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>area</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>cv2</span><span class=o>.</span><span class=n>contourArea</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>contours</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>area</span> <span class=o>&gt;</span> <span class=mi>1500</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cv2</span><span class=o>.</span><span class=n>drawContours</span><span class=p>(</span><span class=n>cropped</span><span class=p>,</span> <span class=n>contours</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span> <span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Object detected. Do something</span>
</span></span><span class=line><span class=cl><span class=n>cv2</span><span class=o>.</span><span class=n>drawContours</span><span class=p>(</span><span class=n>cropped</span><span class=p>,</span> <span class=n>contours</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/contour-detection.png alt="Contour detection"></p><p>And there you go! The naughty infiltrator is caught.</p><h2 id=controlling-the-playback>Controlling the playback</h2><p>For controlling the playback, I used a combination of pyautogui and win32con libraries. Since I didn&rsquo;t want to interrupt playbacks on normal times, the object detection is activated only when Youtube is one among the foreground windows.</p><p>Now without much adieu, here is the full code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!C:\Python</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>win32con</span> <span class=kn>import</span> <span class=n>SW_RESTORE</span><span class=p>,</span> <span class=n>SW_SHOW</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cv2</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyautogui</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>win32gui</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TRIGGER_THRESHOLD</span> <span class=o>=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl><span class=n>COOLDOWN_THRESHOLD</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_windows_placement</span><span class=p>(</span><span class=n>window_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>win32gui</span><span class=o>.</span><span class=n>GetWindowPlacement</span><span class=p>(</span><span class=n>window_id</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>set_active_window</span><span class=p>(</span><span class=n>window_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>get_windows_placement</span><span class=p>(</span><span class=n>window_id</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>ShowWindow</span><span class=p>(</span><span class=n>window_id</span><span class=p>,</span> <span class=n>SW_RESTORE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>ShowWindow</span><span class=p>(</span><span class=n>window_id</span><span class=p>,</span> <span class=n>SW_SHOW</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>win32gui</span><span class=o>.</span><span class=n>SetForegroundWindow</span><span class=p>(</span><span class=n>window_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>win32gui</span><span class=o>.</span><span class=n>SetActiveWindow</span><span class=p>(</span><span class=n>window_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search_and_restore_youtube</span><span class=p>(</span><span class=n>window_id</span><span class=p>,</span> <span class=n>hwnd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;YouTube&#34;</span> <span class=ow>in</span> <span class=n>win32gui</span><span class=o>.</span><span class=n>GetWindowText</span><span class=p>(</span><span class=n>window_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>set_active_window</span><span class=p>(</span><span class=n>window_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_for_youtube</span><span class=p>(</span><span class=n>window_id</span><span class=p>,</span> <span class=n>hwnd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;YouTube&#34;</span> <span class=ow>in</span> <span class=n>win32gui</span><span class=o>.</span><span class=n>GetWindowText</span><span class=p>(</span><span class=n>window_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>hwnd</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>window_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FrameCounter</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>minimized</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;nf_max&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>(</span><span class=s2>&#34;Current count: </span><span class=si>{}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>counter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>found</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=s2>&#34;nf_max&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;f_max&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=s2>&#34;f_max&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>&gt;</span> <span class=n>TRIGGER_THRESHOLD</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>minimize_all_windows</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;f_min&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>next</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>not_found</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=s2>&#34;f_min&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;nf_min&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=s2>&#34;nf_min&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>TRIGGER_THRESHOLD</span> <span class=o>-</span> <span class=n>COOLDOWN_THRESHOLD</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>restore_firefox</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;nf_max&#34;</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1>#forget and forgive</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span><span class=s2>&#34;f_max&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>counter</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=nb>next</span> 
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>minimize_all_windows</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Minimizing firefox at </span><span class=si>{0}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>counter</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>pyautogui</span><span class=o>.</span><span class=n>hotkey</span><span class=p>(</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pyautogui</span><span class=o>.</span><span class=n>hotkey</span><span class=p>(</span><span class=s1>&#39;win&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>minimized</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>restore_firefox</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Restoring firefox at </span><span class=si>{0}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>counter</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>EnumWindows</span><span class=p>(</span><span class=n>search_and_restore_youtube</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pyautogui</span><span class=o>.</span><span class=n>hotkey</span><span class=p>(</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>minimized</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_kids</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span> <span class=n>frame_counter</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cropped</span> <span class=o>=</span> <span class=n>frame</span><span class=p>[</span><span class=mi>100</span><span class=p>:</span><span class=mi>300</span><span class=p>,</span> <span class=mi>0</span><span class=p>:</span><span class=mi>630</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Blur the image</span>
</span></span><span class=line><span class=cl>    <span class=n>blur</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>blur</span><span class=p>(</span><span class=n>cropped</span><span class=p>,</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Convert to HSV color space</span>
</span></span><span class=line><span class=cl>    <span class=n>hsv</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>blur</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_BGR2HSV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># define range of blue color in HSV</span>
</span></span><span class=line><span class=cl>    <span class=n>lower_black</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>upper_black</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>180</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>50</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create a binary image with where the head will be white while the rest is black</span>
</span></span><span class=line><span class=cl>    <span class=n>thresh</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>inRange</span><span class=p>(</span><span class=n>hsv</span><span class=p>,</span> <span class=n>lower_black</span><span class=p>,</span> <span class=n>upper_black</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_</span><span class=p>,</span> <span class=n>contours</span><span class=p>,</span> <span class=n>hierarchy</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>findContours</span><span class=p>(</span><span class=n>thresh</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>RETR_TREE</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>CHAIN_APPROX_SIMPLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>contours</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>area</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>cv2</span><span class=o>.</span><span class=n>contourArea</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>contours</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>area</span> <span class=o>&gt;</span> <span class=mi>1500</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cv2</span><span class=o>.</span><span class=n>drawContours</span><span class=p>(</span><span class=n>cropped</span><span class=p>,</span> <span class=n>contours</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span> <span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>frame_counter</span><span class=o>.</span><span class=n>found</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>frame_counter</span><span class=o>.</span><span class=n>not_found</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>frame_counter</span><span class=o>.</span><span class=n>not_found</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cv2</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=s1>&#39;filtered&#39;</span><span class=p>,</span><span class=n>cropped</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cap</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>VideoCapture</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cap</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>cv2</span><span class=o>.</span><span class=n>CAP_PROP_POS_MSEC</span><span class=p>,</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>frame_counter</span> <span class=o>=</span> <span class=n>FrameCounter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>hwnd</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span><span class=n>cap</span><span class=o>.</span><span class=n>isOpened</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Run only when Youtube is one of the running window titles</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>EnumWindows</span><span class=p>(</span><span class=n>check_for_youtube</span><span class=p>,</span> <span class=n>hwnd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>hwnd</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>ret</span><span class=p>,</span> <span class=n>frame</span> <span class=o>=</span> <span class=n>cap</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>find_kids</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span><span class=n>frame_counter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>waitKey</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>k</span> <span class=o>==</span> <span class=mi>27</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>cap</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cv2</span><span class=o>.</span><span class=n>destroyAllWindows</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=results>Results</h2><p>Overall, I would say that the whole exercise was quite effective. The kids have learnt stay away from TV- well, most of the times. Sometimes they do succumb to the temptation and get closer. And when the playback stops, they move away from the TV and wait for the playback to automatically resume. It seems they have figured out their environment on their own.</p><p>But the kids cognition process is not without its faults, there were some unexpected results. For instance, my son developed a superstition that everytime the playback stops he needs to run all the way to kitchen for it to resume (exactly the time taken for the resume timer to cooldown) and so far he hasn&rsquo;t observed any counter-examples to break the correlation between trip to kitchen and resumption of youtube videos. But I expect that over the next few days he will refine his model of environment. My daughter has developed no such belief, she climbs back in to the couch and patiently waits for the playback to resume.</p><p>Now, I think I have solved my initial problem satisfactorily using technology, further strengthening my conviction that when used properly, technology can be a solution and not a problem. Now all I need to do is find some technical solutions to get rid of those earworm rhymes that I keep awkwardly humming in public.</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>tmzh</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-03-02</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/python/>python</a>
<a href=/tags/opencv/>opencv</a></div><nav class=post-nav><a class=prev href=/post/2020-09-20-gpt-3-and-prospects-of-artificial-general-intelligence/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">GPT-3 and prospects of Artificial General Intelligence</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/2019-01-05-using-spark-and-matplotlib-to-visualize-air-routes-for-major-airports-around-the-world/><span class="next-text nav-default">Visualizing air routes for major airports using Spark and Matplotlib</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=https://github.com/tmzh/tmzh.github.io class="iconfont icon-github" title=github></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span><span class=copyright-year>&copy;
2017 -
2023<span class=heart><i class="iconfont icon-heart"></i></span><span>tmzh</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>